/*!
  
  jquery.nInputFile.js
  
  Version: 0.1.0
  Author: Nunifuchisaka(nunifuchisaka@gmail.com)
  Website: http://nunifuchisaka.com/w/n-input-file/demo
  Repository: https://github.com/Nunifuchisaka/nInputFile
  
*/
!function(o,e,t,i){if(e.File&&e.FileReader&&e.FileList&&e.Blob){e.nInputFile={},nInputFile.template={};var l=Backbone.Model.extend({defaults:function(){return{fileData:null,value:null}}});nInputFile.InputImg1_Collection=Backbone.Collection.extend({model:l}),nInputFile.InputImg1=Backbone.View.extend({initialize:function(e){console.log("InputImg1"),_.bindAll(this,"init2","add_model","changeFileData","render","click","remove","loadLocalImage"),this.opts=_.extend({min:2},e),this.$items=this.$(".js_items"),this.$input=this.$("input[type='file']"),this.collection.on("add",this.add_model),this.collection.on("change:fileData",this.changeFileData),this.collection.on("change:result",this.render),this.collection.on("remove",this.init2),this.init2(),this.$input.change(this.loadLocalImage),this.$el.on("click",".is_default",this.click),this.$el.on("click",".js_remove",this.remove)},init2:function(){if(this.opts.min>this.collection.length)for(;this.opts.min>this.collection.length;)this.collection.add({});else this.collection.at(this.collection.length-1).get("result")&&this.collection.add({})},add_model:function(e){var t=e.get("fileData");if(t){var i=new FileReader;i.onload=function(){e.set(i)},i.readAsDataURL(t)}var l=nInputFile.template.input_img_1({cid:e.cid,fileData:null}),n=o(l);e.set({$el:n},{silent:!0}),this.$items.append(n)},changeFileData:function(e){console.group("changeFileData"),console.log(e);var t=e.get("fileData"),i=new FileReader;i.onload=function(){e.set(i)},i.readAsDataURL(t),console.groupEnd()},render:function(e){console.group("render"),console.log("model",e);var t=e.get("$el"),i=e.toJSON(),l=_.extend(i,{cid:e.cid});console.log("args",l),console.log("fileData",l.fileData);var n=nInputFile.template.input_img_1__result(l);t.find(".is_default").remove(),t.prepend(n),this.init2(),console.groupEnd()},click:function(e){return this.$input.click(),!1},remove:function(e){var t=o(e.currentTarget).data("cid"),i=this.collection.get(t);i.get("$el").remove(),this.collection.remove(i)},loadLocalImage:function(e){var i=this;console.log(e.target.files),_.each(e.target.files,function(e){var t=i.collection.findWhere({fileData:null});console.log("emptyModel",t),t?t.set("fileData",e):i.collection.add({fileData:e})})}})}else console.log("File APIに対応していない")}(jQuery,this,this.document);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjExMF9oZWFkZXIuanMiLCI0MTBfVmlldy5qcyIsIjk5MF9mb290ZXIuanMiXSwibmFtZXMiOlsiJCIsIndpbmRvdyIsImRvY3VtZW50IiwidW5kZWZpbmVkIiwiRmlsZSIsIkZpbGVSZWFkZXIiLCJGaWxlTGlzdCIsIkJsb2IiLCJuSW5wdXRGaWxlIiwidGVtcGxhdGUiLCJJbnB1dEltZzFfTW9kZWwiLCJCYWNrYm9uZSIsIk1vZGVsIiwiZXh0ZW5kIiwiZGVmYXVsdHMiLCJmaWxlRGF0YSIsInZhbHVlIiwiSW5wdXRJbWcxX0NvbGxlY3Rpb24iLCJDb2xsZWN0aW9uIiwibW9kZWwiLCJJbnB1dEltZzEiLCJWaWV3IiwiaW5pdGlhbGl6ZSIsIm9wdHMiLCJjb25zb2xlIiwibG9nIiwiXyIsImJpbmRBbGwiLCJ0aGlzIiwibWluIiwiJGl0ZW1zIiwiJGlucHV0IiwiY29sbGVjdGlvbiIsIm9uIiwiYWRkX21vZGVsIiwiY2hhbmdlRmlsZURhdGEiLCJyZW5kZXIiLCJpbml0MiIsImNoYW5nZSIsImxvYWRMb2NhbEltYWdlIiwiJGVsIiwiY2xpY2siLCJyZW1vdmUiLCJsZW5ndGgiLCJhZGQiLCJhdCIsImdldCIsInJlYWRlciIsIm9ubG9hZCIsInNldCIsInJlYWRBc0RhdGFVUkwiLCJodG1sIiwiaW5wdXRfaW1nXzEiLCJjaWQiLCJzaWxlbnQiLCJhcHBlbmQiLCJncm91cCIsImdyb3VwRW5kIiwiZGF0YSIsInRvSlNPTiIsImFyZ3MiLCJpbnB1dF9pbWdfMV9fcmVzdWx0IiwiZmluZCIsInByZXBlbmQiLCJlIiwiY3VycmVudFRhcmdldCIsInNlbGYiLCJ0YXJnZXQiLCJmaWxlcyIsImVhY2giLCJlbXB0eU1vZGVsIiwiZmluZFdoZXJlIiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0NBVUEsU0FBQUEsRUFBQUMsRUFBQUMsRUFBQUMsR0NUQSxHQUFBRixFQUFBRyxNQUFBSCxFQUFBSSxZQUFBSixFQUFBSyxVQUFBTCxFQUFBTSxLQUFBLENB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R0FDQWxDLEVBQUEyQixJQUFBLE9BQ0FKLFNBQ0FkLEtBQUFJLFdBQUFVLE9BQUF2QixJQUdBb0IsZUFBQSxTQUFBeUIsR0FDQSxJQUFBRSxFQUFBdEMsS0FDQUosUUFBQUMsSUFBQXVDLEVBQUFHLE9BQUFDLE9BSUExQyxFQUFBMkMsS0FBQUwsRUFBQUcsT0FBQUMsTUFBQSxTQUFBckQsR0FDQSxJQUFBdUQsRUFBQUosRUFBQWxDLFdBQUF1QyxVQUFBLENBQUF4RCxTQUFBLE9BQ0FTLFFBQUFDLElBQUEsYUFBQTZDLEdBQ0FBLEVBQ0FBLEVBQUFyQixJQUFBLFdBQUFsQyxHQUVBbUQsRUFBQWxDLFdBQUFZLElBQUEsQ0FDQTdCLFNBQUFBLGNBc0JBUyxRQUFBQyxJQUFBLG9CRDdKQSxDRVZBK0MsT0FBQTVDLEtBQUFBLEtBQUExQiIsImZpbGUiOiJqcXVlcnkubklucHV0RmlsZS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAgXG4gIGpxdWVyeS5uSW5wdXRGaWxlLmpzXG4gIFxuICBWZXJzaW9uOiAwLjEuMFxuICBBdXRob3I6IE51bmlmdWNoaXNha2EobnVuaWZ1Y2hpc2FrYUBnbWFpbC5jb20pXG4gIFdlYnNpdGU6IGh0dHA6Ly9udW5pZnVjaGlzYWthLmNvbS93L24taW5wdXQtZmlsZS9kZW1vXG4gIFJlcG9zaXRvcnk6IGh0dHBzOi8vZ2l0aHViLmNvbS9OdW5pZnVjaGlzYWthL25JbnB1dEZpbGVcbiAgXG4qL1xuOyhmdW5jdGlvbigkLCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpe1xuXCIndXNlIHN0cmljdFwiOyIsIi8vIEZpbGUgQVBJ44Gr5a++5b+c44GX44Gm44GE44KL44GL56K66KqNXG5pZih3aW5kb3cuRmlsZSAmJiB3aW5kb3cuRmlsZVJlYWRlciAmJiB3aW5kb3cuRmlsZUxpc3QgJiYgd2luZG93LkJsb2IpIHtcblxud2luZG93Lm5JbnB1dEZpbGUgPSB7fTtcbm5JbnB1dEZpbGUudGVtcGxhdGUgPSB7fTtcblxuXG5cbi8qXG4jIyBJbnB1dEltZzFcbiovXG5cbnZhciBJbnB1dEltZzFfTW9kZWwgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoe1xuICBkZWZhdWx0czogZnVuY3Rpb24oKXtcbiAgICByZXR1cm4ge1xuICAgICAgZmlsZURhdGE6IG51bGwsXG4gICAgICB2YWx1ZTogbnVsbFxuICAgIH1cbiAgfVxufSk7XG5cblxubklucHV0RmlsZS5JbnB1dEltZzFfQ29sbGVjdGlvbiA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHtcbiAgbW9kZWw6IElucHV0SW1nMV9Nb2RlbFxufSk7XG5cblxubklucHV0RmlsZS5JbnB1dEltZzEgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG4gIFxuICBpbml0aWFsaXplOiBmdW5jdGlvbihvcHRzKXtcbiAgICBjb25zb2xlLmxvZyhcIklucHV0SW1nMVwiKTtcbiAgICBfLmJpbmRBbGwodGhpcywgXCJpbml0MlwiLCBcImFkZF9tb2RlbFwiLCBcImNoYW5nZUZpbGVEYXRhXCIsIFwicmVuZGVyXCIsIFwiY2xpY2tcIiwgXCJyZW1vdmVcIiwgXCJsb2FkTG9jYWxJbWFnZVwiKTtcbiAgICB0aGlzLm9wdHMgPSBfLmV4dGVuZCh7XG4gICAgICBtaW46IDJcbiAgICB9LCBvcHRzKTtcbiAgICBcbiAgICB0aGlzLiRpdGVtcyA9IHRoaXMuJChcIi5qc19pdGVtc1wiKTtcbiAgICB0aGlzLiRpbnB1dCA9IHRoaXMuJChcImlucHV0W3R5cGU9J2ZpbGUnXVwiKTtcbiAgICBcbiAgICB0aGlzLmNvbGxlY3Rpb24ub24oXCJhZGRcIiwgdGhpcy5hZGRfbW9kZWwpO1xuICAgIFxuICAgIHRoaXMuY29sbGVjdGlvbi5vbihcImNoYW5nZTpmaWxlRGF0YVwiLCB0aGlzLmNoYW5nZUZpbGVEYXRhKTtcbiAgICB0aGlzLmNvbGxlY3Rpb24ub24oXCJjaGFuZ2U6cmVzdWx0XCIsIHRoaXMucmVuZGVyKTtcbiAgICB0aGlzLmNvbGxlY3Rpb24ub24oXCJyZW1vdmVcIiwgdGhpcy5pbml0Mik7XG4gICAgXG4gICAgdGhpcy5pbml0MigpO1xuICAgIFxuICAgIHRoaXMuJGlucHV0LmNoYW5nZSh0aGlzLmxvYWRMb2NhbEltYWdlKTtcbiAgICAvL3RoaXMuJGVsLm9uKFwiY2hhbmdlXCIsIFwiaW5wdXRbdHlwZT0nZmlsZSddXCIsIHRoaXMubG9hZExvY2FsSW1hZ2UpO1xuICAgIHRoaXMuJGVsLm9uKFwiY2xpY2tcIiwgXCIuaXNfZGVmYXVsdFwiLCB0aGlzLmNsaWNrKTtcbiAgICB0aGlzLiRlbC5vbihcImNsaWNrXCIsIFwiLmpzX3JlbW92ZVwiLCB0aGlzLnJlbW92ZSk7XG4gIH0sXG4gIFxuICBpbml0MjogZnVuY3Rpb24oKXtcbiAgICBpZiggdGhpcy5vcHRzLm1pbiA+IHRoaXMuY29sbGVjdGlvbi5sZW5ndGggKXtcbiAgICAgIC8v44Oi44OH44Or44Gu5pWw44GM5pyA5bCP44Gr5rqA44Gf44Gq44GE44Go44GN44CB5pyA5bCP44G+44Gn6L+95Yqg44GZ44KLXG4gICAgICB3aGlsZSggdGhpcy5vcHRzLm1pbiA+IHRoaXMuY29sbGVjdGlvbi5sZW5ndGggKXtcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uLmFkZCh7fSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8v44Oi44OH44Or44GM6Laz44KK44Gq44GP44Gq44Gj44Gf44KJ6L+95Yqg44GZ44KLXG4gICAgICB2YXIgbGFzdF9tb2RlbCA9IHRoaXMuY29sbGVjdGlvbi5hdCh0aGlzLmNvbGxlY3Rpb24ubGVuZ3RoIC0gMSk7XG4gICAgICBpZiggbGFzdF9tb2RlbC5nZXQoXCJyZXN1bHRcIikgKXtcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uLmFkZCh7fSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBcbiAgYWRkX21vZGVsOiBmdW5jdGlvbihtb2RlbCl7XG4gICAgdmFyIGZpbGVEYXRhID0gbW9kZWwuZ2V0KFwiZmlsZURhdGFcIik7XG4gICAgaWYoIGZpbGVEYXRhICl7XG4gICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbigpe1xuICAgICAgICBtb2RlbC5zZXQocmVhZGVyKTtcbiAgICAgIH1cbiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGVEYXRhKTtcbiAgICB9XG4gICAgLy9cbiAgICB2YXIgaHRtbCA9IG5JbnB1dEZpbGUudGVtcGxhdGUuaW5wdXRfaW1nXzEoe1xuICAgICAgY2lkOiBtb2RlbC5jaWQsXG4gICAgICBmaWxlRGF0YTogbnVsbFxuICAgICAgLy8sdmFsdWU6IEpTT04uc3RyaW5naWZ5KCBtb2RlbC50b0pTT04oKSApXG4gICAgfSk7XG4gICAgdmFyICRlbCA9ICQoaHRtbCk7XG4gICAgbW9kZWwuc2V0KHtcIiRlbFwiOiAkZWx9LHtzaWxlbnQ6IHRydWV9KTtcbiAgICB0aGlzLiRpdGVtcy5hcHBlbmQoJGVsKTtcbiAgfSxcbiAgXG4gIGNoYW5nZUZpbGVEYXRhOiBmdW5jdGlvbihtb2RlbCl7XG4gICAgY29uc29sZS5ncm91cChcImNoYW5nZUZpbGVEYXRhXCIpO1xuICAgIGNvbnNvbGUubG9nKG1vZGVsKTtcbiAgICB2YXIgZmlsZURhdGEgPSBtb2RlbC5nZXQoXCJmaWxlRGF0YVwiKTtcbiAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24oKXtcbiAgICAgIG1vZGVsLnNldChyZWFkZXIpO1xuICAgIH1cbiAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlRGF0YSk7XG4gICAgY29uc29sZS5ncm91cEVuZCgpO1xuICB9LFxuICBcbiAgcmVuZGVyOiBmdW5jdGlvbihtb2RlbCl7XG4gICAgY29uc29sZS5ncm91cChcInJlbmRlclwiKTtcbiAgICBjb25zb2xlLmxvZyhcIm1vZGVsXCIsIG1vZGVsKTtcbiAgICB2YXIgJGVsID0gbW9kZWwuZ2V0KFwiJGVsXCIpO1xuICAgIHZhciBkYXRhID0gbW9kZWwudG9KU09OKCk7XG4gICAgdmFyIGFyZ3MgPSBfLmV4dGVuZChkYXRhLCB7XG4gICAgICBjaWQ6IG1vZGVsLmNpZFxuICAgIH0pO1xuICAgIGNvbnNvbGUubG9nKFwiYXJnc1wiLCBhcmdzKTtcbiAgICBjb25zb2xlLmxvZyhcImZpbGVEYXRhXCIsIGFyZ3MuZmlsZURhdGEgKTtcbiAgICB2YXIgaHRtbCA9IG5JbnB1dEZpbGUudGVtcGxhdGUuaW5wdXRfaW1nXzFfX3Jlc3VsdChhcmdzKTtcbiAgICAkZWwuZmluZChcIi5pc19kZWZhdWx0XCIpLnJlbW92ZSgpO1xuICAgICRlbC5wcmVwZW5kKGh0bWwpO1xuICAgIFxuICAgIHRoaXMuaW5pdDIoKTtcbiAgICBjb25zb2xlLmdyb3VwRW5kKCk7XG4gIH0sXG4gIFxuICBjbGljazogZnVuY3Rpb24oZSl7XG4gICAgdGhpcy4kaW5wdXQuY2xpY2soKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG4gIFxuICByZW1vdmU6IGZ1bmN0aW9uKGUpe1xuICAgIHZhciAkbWUgPSAkKGUuY3VycmVudFRhcmdldCksXG4gICAgICAgIGNpZCA9ICRtZS5kYXRhKFwiY2lkXCIpO1xuICAgIHZhciBtb2RlbCA9IHRoaXMuY29sbGVjdGlvbi5nZXQoY2lkKTtcbiAgICB2YXIgJGVsID0gbW9kZWwuZ2V0KFwiJGVsXCIpO1xuICAgICRlbC5yZW1vdmUoKTtcbiAgICB0aGlzLmNvbGxlY3Rpb24ucmVtb3ZlKG1vZGVsKTtcbiAgfSxcbiAgXG4gIGxvYWRMb2NhbEltYWdlOiBmdW5jdGlvbihlKXtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgY29uc29sZS5sb2coZS50YXJnZXQuZmlsZXMpO1xuICAgIC8vY29uc29sZS5sb2coZS50YXJnZXQuZmlsZXMpO1xuICAgIC8vdGhpcy5jb2xsZWN0aW9uLnNldChlLnRhcmdldC5maWxlcyk7XG4gICAgXG4gICAgXy5lYWNoKGUudGFyZ2V0LmZpbGVzLCBmdW5jdGlvbihmaWxlRGF0YSl7XG4gICAgICB2YXIgZW1wdHlNb2RlbCA9IHNlbGYuY29sbGVjdGlvbi5maW5kV2hlcmUoe1wiZmlsZURhdGFcIjogbnVsbH0pO1xuICAgICAgY29uc29sZS5sb2coXCJlbXB0eU1vZGVsXCIsIGVtcHR5TW9kZWwpO1xuICAgICAgaWYoIGVtcHR5TW9kZWwgKXtcbiAgICAgICAgZW1wdHlNb2RlbC5zZXQoXCJmaWxlRGF0YVwiLCBmaWxlRGF0YSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZWxmLmNvbGxlY3Rpb24uYWRkKHtcbiAgICAgICAgICBcImZpbGVEYXRhXCI6IGZpbGVEYXRhXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIFxuICAgIC8qXG4gICAgdmFyIGZpbGVEYXRhID0gZS50YXJnZXQuZmlsZXNbMF07XG4gICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uKCl7XG4gICAgICBjb25zb2xlLmxvZyhcInJlYWRlclwiLCByZWFkZXIpO1xuICAgICAgbW9kZWwuc2V0KHJlYWRlcik7XG4gICAgfVxuICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGVEYXRhKTtcbiAgICAqL1xuICB9XG4gIFxufSk7XG5cblxufSBlbHNlIHtcbiAgLy8gRmlsZSBBUEnjgavlr77lv5zjgZfjgabjgYTjgarjgYTloLTlkIhcbiAgY29uc29sZS5sb2coXCJGaWxlIEFQSeOBq+WvvuW/nOOBl+OBpuOBhOOBquOBhFwiKTtcbn1cbiIsIn0pKGpRdWVyeSwgdGhpcywgdGhpcy5kb2N1bWVudCk7Il19
